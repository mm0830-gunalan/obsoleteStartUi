<mvc:View
    controllerName="obsolerteworkflow.workflowuimodule.controller.App"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.ui.layout.form"
    xmlns:u="sap.ui.unified"
    xmlns:table="sap.ui.table"
    displayBlock="true"
    height="100%"
>
    <App id="app1">
        <Page
            title="{i18n>pageTitle}"
            enableScrolling="false"
            class="sapUiContentPadding"
        >
            <content>
                <FlexBox
                    direction="Column"
                    height="100%"
                    fitContainer="true"
                >
                    <!-- Top Form -->
                    <VBox class="sapUiSmallMargin">
                        <layoutData>
                            <FlexItemData
                                growFactor="0"
                                shrinkFactor="0"
                            />
                        </layoutData>

                        <f:SimpleForm
                            id="uploadForm"
                            layout="ResponsiveGridLayout"
                            editable="true"
                            labelSpanXL="3"
                            labelSpanL="3"
                            labelSpanM="4"
                            labelSpanS="12"
                            adjustLabelSpan="false"
                            emptySpanXL="4"
                            emptySpanL="4"
                            emptySpanM="0"
                            emptySpanS="0"
                            columnsXL="1"
                            columnsL="1"
                            columnsM="1"
                        >
                            <!-- Company Dropdown -->
                            <Label
                                text="{i18n>labelCompany}"
                                required="true"
                            />
                            <Select
                                id="companySelect"
                                width="100%"
                                selectedKey="{/company}"
                                forceSelection="false"
                                change="onCompanyChange"
                                items="{
                                    path: 'obsolete>/Companies',
                                    filters: [
                                      { path: 'isActive', operator: 'EQ', value1: true }
                                    ]
                                }"
                            >
                                <core:Item
                                    key="{obsolete>companyCode}"
                                    text="{= ${obsolete>companyCode} + ' - ' + ${obsolete>companyName} }"
                                />
                            </Select>

                            <!-- Excel Upload -->
                            <Label
                                text="{i18n>labelUploadExcel}"
                                required="true"
                            />
                            <u:FileUploader
                                id="excelUploader"
                                fileType="xlsx"
                                placeholder="{i18n>placeholderChooseFile}"
                                buttonText="{i18n>buttonBrowse}"
                                width="100%"
                                change="onFileChange"
                                useMultipart="false"
                                enabled="{view>/fileUploadEnabled}"
                            />
                        </f:SimpleForm>
                    </VBox>

                    <!-- Error Grid Table -->
                    <table:Table
                        id="errorTable"
                        rows="{WorkflowItem>/items}"
                        selectionMode="None"
                        visibleRowCountMode="Auto"
                        class="sapUiSmallMarginTop"
                        fixedColumnCount="3"
                    >
                        <table:layoutData>
                            <FlexItemData
                                growFactor="1"
                                shrinkFactor="1"
                                baseSize="0%"
                            />
                        </table:layoutData>

                        <table:extension>
                            <OverflowToolbar>
                                <Title
                                    text="{i18n>titleObsoleteItem}"
                                    level="H2"
                                />
                                <ToolbarSpacer />
                                <SearchField
                                    width="15rem"
                                    placeholder="{i18n>searchPlaceholder}"
                                    liveChange="onSearchTable"
                                />
                                <CheckBox
                                    text="{i18n>checkboxShowErrors}"
                                    select="onToggleErrorFilter"
                                />
                            </OverflowToolbar>
                        </table:extension>

                        <table:columns>
                            <table:Column width="10rem">
                                <Label text="{i18n>colError}" />
                                <table:template>
                                    <HBox>
                                        <Button
                                            text="{= 'View Error (' + ${WorkflowItem>errorCount} + ')' }"
                                            type="Negative"
                                            press="onErrorPress"
                                            visible="{= ${WorkflowItem>errorCount} > 0 }"
                                        />
                                        <ObjectStatus
                                            text="{i18n>statusNoError}"
                                            state="Success"
                                            visible="{= ${WorkflowItem>errorCount} === 0 }"
                                        />
                                    </HBox>
                                </table:template>
                            </table:Column>

                            <table:Column width="8rem">
                                <Label text="{i18n>colPlant}" />
                                <table:template>
                                    <Text text="{WorkflowItem>plant}" />
                                </table:template>
                            </table:Column>

                            <table:Column width="12rem">
                                <Label text="{i18n>colComponent}" />
                                <table:template>
                                    <Text text="{WorkflowItem>component}" />
                                </table:template>
                            </table:Column>

                            <table:Column width="10rem">
                                <Label text="{i18n>colRFQ}" />
                                <table:template>
                                    <Text text="{WorkflowItem>rfq}" />
                                </table:template>
                            </table:Column>

                            <table:Column width="17rem">
                                <Label text="{i18n>colDescription}" />
                                <table:template>
                                    <Text
                                        text="{WorkflowItem>description}"
                                        wrapping="false"
                                    />
                                </table:template>
                            </table:Column>

                            <table:Column width="13rem">
                                <Label text="{i18n>colManufacturerPart}" />
                                <table:template>
                                    <Text
                                        text="{WorkflowItem>manufacturerPart}"
                                    />
                                </table:template>
                            </table:Column>

                            <table:Column width="8rem">
                                <Label text="{i18n>colAvailableStock}" />
                                <table:template>
                                    <Text
                                        text="{WorkflowItem>availableStock}"
                                    />
                                </table:template>
                            </table:Column>

                            <table:Column width="14rem">
                                <Label text="{i18n>colFreeStock}" />
                                <table:template>
                                    <Text text="{WorkflowItem>freeStock}" />
                                </table:template>
                            </table:Column>

                            <table:Column width="5rem">
                                <Label text="{i18n>colCurrency}" />
                                <table:template>
                                    <Text text="{WorkflowItem>currency}" />
                                </table:template>
                            </table:Column>

                            <table:Column width="9rem">
                                <Label text="{i18n>colLastConsumption}" />
                                <table:template>
                                    <Text
                                        text="{path: 'WorkflowItem>lastConsumption', type: 'sap.ui.model.type.Date', formatOptions: {pattern: 'dd.MM.yyyy'}}"
                                    />
                                </table:template>
                            </table:Column>

                            <table:Column width="8rem">
                                <Label text="{i18n>colRangeCoverage}" />
                                <table:template>
                                    <Text text="{WorkflowItem>rangeCoverage}" />
                                </table:template>
                            </table:Column>

                            <table:Column width="10rem">
                                <Label text="{i18n>colPN}" />
                                <table:template>
                                    <Text text="{WorkflowItem>pn}" />
                                </table:template>
                            </table:Column>

                            <table:Column width="10rem">
                                <Label text="{i18n>colCustomer}" />
                                <table:template>
                                    <Text text="{WorkflowItem>customer}" />
                                </table:template>
                            </table:Column>

                            <table:Column width="10rem">
                                <Label text="{i18n>colEndCustomer}" />
                                <table:template>
                                    <Text text="{WorkflowItem>endCustomer}" />
                                </table:template>
                            </table:Column>

                            <table:Column width="8rem">
                                <Label text="{i18n>colReason}" />
                                <table:template>
                                    <Text text="{WorkflowItem>reason}" />
                                </table:template>
                            </table:Column>

                            <table:Column width="7rem">
                                <Label text="{i18n>colCaused}" />
                                <table:template>
                                    <Text text="{WorkflowItem>caused}" />
                                </table:template>
                            </table:Column>

                            <table:Column width="8rem">
                                <Label text="{i18n>colTotalAmount}" />
                                <table:template>
                                    <Text text="{WorkflowItem>totalAmount}" />
                                </table:template>
                            </table:Column>

                            <table:Column width="8rem">
                                <Label text="{i18n>colWeight}" />
                                <table:template>
                                    <Text text="{WorkflowItem>weight}" />
                                </table:template>
                            </table:Column>
                        </table:columns>
                    </table:Table>
                </FlexBox>
            </content>

            <!-- Footer -->
            <footer>
                <Toolbar>
                    <ToolbarSpacer />
                    <Button
                        text="{i18n>btnSubmit}"
                        type="Emphasized"
                        press="onSubmit"
                    />
                </Toolbar>
            </footer>
        </Page>
    </App>
</mvc:View>
